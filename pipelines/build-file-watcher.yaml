pool:
  vmImage: 'ubuntu-latest'

trigger:
  paths:
    include:
      - src/EdgeModules/FileWatcher
      - pipelines/build-file-watcher.yaml

steps:
- task: Docker@2
  displayName: Docker Build of File Watcher module amd64
  inputs:
    containerRegistry: 'catcamacr-dev'
    repository: 'file-watcher'
    command: 'build'
    Dockerfile: 'src/EdgeModules/FileWatcher/Dockerfile.amd64'
    buildContext: 'src'
    tags: 'amd64-latest'

- task: Docker@2
  displayName: Docker Push of File Watcher module
  inputs:
    containerRegistry: 'catcamacr-dev'
    repository: 'file-watcher'
    command: 'push'
    tags: 'amd64-latest'

- task: Docker@2
  displayName: Docker Build of File Watcher module arm32
  inputs:
    containerRegistry: 'catcamacr-dev'
    repository: 'file-watcher'
    command: 'build'
    Dockerfile: 'src/EdgeModules/FileWatcher/Dockerfile.arm32v7'
    buildContext: 'src'
    tags: 'arm32-latest'

- task: Docker@2
  displayName: Docker Push of File Watcher module
  inputs:
    containerRegistry: 'catcamacr-dev'
    repository: 'file-watcher'
    command: 'push'
    tags: 'arm32-latest'    